<html>
	<head>
		<style type="text/css">
	  	  #conversationList { list-style-type: none; margin: 0; padding: 0; }
	      #conversationList li { padding: 5px 10px; }
	      #conversationList li:nth-child(odd) { background: #eee; }

	      #messages { list-style-type: none; margin: 0; padding: 0; }
      	  #messages li { padding: 5px 10px; }
      	  #messages li:nth-child(odd) { background: #CCFF99; }

  		</style>
	</head>
	<body>
		<h3>Conversations</h3>

		<div id="conversations">
			<ul id="conversationList"></ul>
		</div>

		<h3>Chat</h3>

		<div id="chatWindow">
	  		<ul id="messages"></ul>
	  	</div>

		<div id="messageWindow">
	  		<div id ="status"></div>
	  		<form action="" id="chatForm">
	  			<input id="m" autocomplete="off" /><button>Send</button>
	  		</form>
	  	</div>

		<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
		<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
		<script>
		var socket =io();
		
		$('#chatForm').submit(function(){
			socket.emit('chatMessage', $('#m').val());
			appendMessage($('#m').val());
			$('#m').val('');
			return false;
		});

		socket.on('conversationCreated', function(conversation){
			var button = createButton(conversation["conversationId"])
			$('#conversationList').append($('<li>').text(conversation["name"] + " - " + conversation["message"])).append(button);//.append($('button').text('Join conversation')));
		});

		socket.on('chatMessage', function(clientId, message){
			appendMessage(message);
		});

		function createButton(conversationId){
			var button = $('<button/>', {
				text: 'Join Conversation',

				id: 'btn_' + conversationId,
				click: function(){ 
					socket.emit('joinConversation', conversationId, 'pharmacist');
				}
			});
			return button;
		}

		function appendMessage(msg){
	      $('#messages').append($('<li>').text(msg));
	    }



		</script>

	</body>
</html>